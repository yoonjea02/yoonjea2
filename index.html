<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê´€ë¦¬ ìš”ê¸ˆ ì˜ˆì¸¡ Â· í™ˆ</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@latest/dist/web/variable/pretendardvariable-dynamic-subset.css" />

  <!-- âœ… ì´ í˜ì´ì§€ì—ì„œ 'ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì—' ì„¹ì…˜ë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ -->
  <style>
    /* ì „ì²´ í˜ì´ì§€ëŠ” ì„¸ë¡œ ìŠ¤í¬ë¡¤ë§Œ ìœ ì§€ */
    body[data-page="home"] { touch-action: pan-y; }
    body[data-page="home"] .wrap { overflow-x: hidden; }

    /* íŒ¨ë„ ìì²´ëŠ” ê³ ì • í­ ìœ ì§€ */
    body[data-page="home"] section.panel[aria-label="ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì—"]{
      overflow: hidden; /* íŒ¨ë„ ë°–ìœ¼ë¡œ ìƒˆì§€ ì•Šê²Œ */
    }

    /* â¬‡ï¸ ì´ ì»¨í…Œì´ë„ˆë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤, í­ì€ 100% ê³ ì • */
    body[data-page="home"] section.panel[aria-label="ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì—"] .cards{
      display: flex !important;           /* ê¸°ì¡´ gridë¥¼ ì´ ì„¹ì…˜ì—ì„œë§Œ flexë¡œ */
      width: 100%;                        /* íŒ¨ë„ ë„ˆë¹„ì— ë§ì¶° ê³ ì • */
      max-width: 100%;
      box-sizing: border-box;
      gap: 12px;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;                /* ê°€ë¡œ ì œìŠ¤ì²˜ë§Œ í—ˆìš© */
      overscroll-behavior-x: contain;     /* ë°”ê¹¥ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì „ì´ ë°©ì§€ */
      scroll-snap-type: x mandatory;      /* ì¹´ë“œë³„ ìŠ¤ëƒ… */
      padding-bottom: 4px;                /* ìŠ¤í¬ë¡¤ë°” ì—¬ë°± */
    }

    /* â¬‡ï¸ ê° ì¹´ë“œëŠ” ì»¨í…Œì´ë„ˆ í­ 100% (ì›ë˜ ì¹´ë“œ í¬ê¸° ìœ ì§€) */
    body[data-page="home"] section.panel[aria-label="ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì—"] .cards > .card{
      flex: 0 0 100%;
      max-width: 100%;
      box-sizing: border-box;
      scroll-snap-align: start;
    }
  </style>
</head>
<body data-page="home">
  <div class="wrap">

    <!-- Header -->
    <header>
      <div class="top-bar">
        <div class="time">19:30</div>
        <div class="status" aria-hidden="true"><span>ğŸ“¶</span><span>ğŸ“¡</span><span>ğŸ”‹</span></div>
      </div>
      <div class="top-actions">
        <a class="btn" href="log.html" aria-label="ë¡œê·¸">ë¡œê·¸</a>
        <div>
          <a class="icon-btn" href="alerts.html" aria-label="ì•Œë¦¼">ğŸ””</a>
          <a class="icon-btn" href="search.html" aria-label="ê²€ìƒ‰">ğŸ”</a>
          <button class="icon-btn" id="openDrawer" aria-label="ì „ì²´ ë©”ë‰´">ğŸ§­</button>
        </div>
      </div>
    </header>

    <!-- Main (í™ˆ ë””ìì¸ ê·¸ëŒ€ë¡œ ìœ ì§€) -->
    <main class="section stack">
      <!-- í”„ë¡œí•„ -->
      <div class="hero" aria-label="í”„ë¡œí•„">
        <div class="avatar" aria-hidden="true">ğŸ‘¤</div>
        <div>
          <div class="name">@@ë‹˜</div>
          <div class="email">aaa123@gmail.com</div>
        </div>
      </div>

      <!-- ì›” ìš”ì•½ -->
      <section class="summary" aria-label="ì´ë‹¬ ê´€ë¦¬ ìš”ê¸ˆ ìš”ì•½">
        <h2>@@ë‹˜ì˜ 8ì›” ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ <span class="kpi" id="totalPrice">32,600 ì›</span></h2>
        <p class="small" id="deltaText">ì§€ë‚œë‹¬ ë³´ë‹¤ 12% ë‚®ì€ ê¸ˆì•¡ì´ì—ìš”!</p>
        <div class="bars">
          <div class="bar">
            <span class="label">7ì›”</span>
            <div class="track"><div class="fill july" id="barJuly" style="width:60%"></div></div>
          </div>
          <div class="bar">
            <span class="label">8ì›”</span>
            <div class="track"><div class="fill aug" id="barAug" style="width:90%"></div></div>
          </div>
        </div>
      </section>

      <!-- ì¹´ë“œ: ì „ê¸°/ê°€ìŠ¤ (ì´ ì„¹ì…˜ë§Œ ê°€ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
      <section class="panel" aria-label="ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì—">
        <h3 style="margin:0 0 12px">ì˜ˆìƒ ê´€ë¦¬ ìš”ê¸ˆ í•œëˆˆì— ëª¨ì•„ë³´ê¸° &gt;</h3>
        <div class="cards">
          <article class="card" aria-label="ì „ê¸°">
            <div class="label">âš¡ ì˜ˆìƒ ì „ê¸° ìš”ê¸ˆ</div>
            <div class="kpi" id="elecPrice">13,830 ì›</div>
            <div class="donut" id="donutElec" style="--percent:42"><div class="center">ì „ê¸° ë¹„ì¤‘</div></div>
          </article>
          <article class="card" aria-label="ê°€ìŠ¤">
            <div class="label">ğŸ”¥ ì˜ˆìƒ ê°€ìŠ¤ ìš”ê¸ˆ</div>
            <div class="kpi" id="gasPrice">7,820 ì›</div>
            <div class="donut" id="donutGas" style="--percent:24"><div class="center">ê°€ìŠ¤ ë¹„ì¤‘</div></div>
          </article>
                    <!-- â• ì¶”ê°€: ìˆ˜ë„ ì¹´ë“œ (cards ì»¨í…Œì´ë„ˆ ë§¨ ë’¤ì— ë¶™ì—¬ë„£ê¸°) -->
          <article class="card" aria-label="ìˆ˜ë„">
            <div class="label">ğŸ’§ ì˜ˆìƒ ìˆ˜ë„ ìš”ê¸ˆ</div>
            <div class="kpi" id="waterPrice">9,400 ì›</div>
            <div class="donut" id="donutWater" style="--percent:33">
              <div class="center">ìˆ˜ë„ ë¹„ì¤‘</div>
            </div>
          </article>
        </div>
      </section>

      <!-- ì ˆì•½ ëª©í‘œ -->
      <section class="goal-card" aria-label="ì ˆì•½ ëª©í‘œ">
        <div class="goal-head">
          <h3 class="goal-title">ì´ë²ˆ ë‹¬ ì ˆì•½ ëª©í‘œ</h3>
          <span id="goalHint" class="goal-meta">ëª©í‘œë¥¼ ì„¤ì •í•´ ì§„í–‰ë¥ ì„ í™•ì¸í•´ ë³´ì„¸ìš”</span>
        </div>

        <div class="progress">
          <div class="progress-track"><div id="goalFill" class="progress-fill"></div></div>
          <div class="progress-label">
            <span id="savedNow">ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: 0 ì›</span>
            <span id="goalPct">0%</span>
          </div>
        </div>

        <form class="goal-form" id="goalForm">
          <input id="goalInput" class="input" type="number" min="0" step="1000" placeholder="ëª©í‘œ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 30000)" />
          <button type="submit" class="btn">ì €ì¥</button>
          <button type="button" id="goalClear" class="btn">ì´ˆê¸°í™”</button>
        </form>

        <div id="goalSuccess" style="display:none">
          <span class="badge-success">ëª©í‘œ ë‹¬ì„±!</span>
        </div>
      </section>
    </main>

    <!-- Footer Tabs -->
    <footer>
      <div class="tabs" aria-label="íƒ­">
        <a class="tab active" href="index.html" aria-label="í™ˆ">í™ˆ</a>
        <a class="tab" href="analysis.html" aria-label="AI ë¶„ì„">AI</a>
        <a class="tab" href="goals.html" aria-label="ì‹¤ì‹œê°„ ìš”ê¸ˆ">ìš”ê¸ˆ</a>
        <a class="tab" href="profile.html" aria-label="ë§ˆì´í˜ì´ì§€">ë§ˆì´</a>
        <button class="tab" id="openDrawer2" type="button" aria-label="ì „ì²´">ì „ì²´</button>
      </div>
    </footer>
  </div>

  <!-- Drawer (ê³µí†µ) -->
  <div class="scrim" id="scrim"></div>
  <aside class="drawer" id="drawer" aria-label="ì „ì²´ ë©”ë‰´">
    <div class="d-hero">
      <div class="d-avatar">ğŸ‘¤</div>
      <div>
        <div class="d-name">@@ë‹˜</div>
        <div class="d-email">aaa123@gmail.com</div>
      </div>
    </div>

    <div class="d-grid">
      <a class="d-btn" href="profile.html"><div class="emoji">ğŸ‘¤</div><div class="label">ì •ë³´ ê´€ë¦¬</div></a>
      <a class="d-btn" href="alerts.html"><div class="emoji">ğŸ””</div><div class="label">ì•Œë¦¼</div></a>
      <a class="d-btn" href="#"><div class="emoji">ğŸ“¢</div><div class="label">ê³µì§€ì‚¬í•­</div></a>
      <a class="d-btn" href="profile.html"><div class="emoji">ğŸ‘¤</div><div class="label">ë§ˆì´í˜ì´ì§€</div></a>
      <a class="d-btn" href="#"><div class="emoji">ğŸ’¬</div><div class="label">ê³ ê°ì„¼í„°</div></a>
      <a class="d-btn" href="search.html"><div class="emoji">ğŸ”</div><div class="label">ê²€ìƒ‰</div></a>
    </div>

    <div class="d-hr"></div>
    <div class="d-actions">
      <a href="#">ë¡œê·¸ì•„ì›ƒ</a>
      <a href="#">íƒˆí‡´í•˜ê¸°</a>
    </div>
  </aside>

  <!-- Scripts -->
  <script src="app3.js" defer></script>
  <script>
    // Drawer (í˜ì´ì§€ ì§„ì… ì‹œ ë‹«í˜ ìƒíƒœ ë³´ì¥)
    (function(){
      const d=document, dr=d.getElementById('drawer'), sc=d.getElementById('scrim');
      if(!dr || !sc) return;
      const open=()=>{ dr.classList.add('open'); sc.classList.add('show'); };
      const close=()=>{ dr.classList.remove('open'); sc.classList.remove('show'); };
      d.getElementById('openDrawer')?.addEventListener('click', open);
      d.getElementById('openDrawer2')?.addEventListener('click', open);
      sc.addEventListener('click', close);
      d.addEventListener('keydown', e=>{ if(e.key==='Escape') close(); });
      d.addEventListener('DOMContentLoaded', close);
    })();
  </script>
  <script>
/*
  [ë¬´ì—‡ì„ í•˜ë‚˜ìš”?]
  - ì„œë²„ì—ì„œ ë„ë„› ì°¨íŠ¸ ë°ì´í„°(ì „ê¸°/ê°€ìŠ¤ ìš”ê¸ˆ + ë¹„ì¤‘)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
  - ê°€ì ¸ì˜¨ ìˆ«ìë¥¼ í™”ë©´ì˜ í…ìŠ¤íŠ¸ì— ë„£ê³ ,
    ë„ë„› ìš”ì†Œì˜ CSS ë³€ìˆ˜(--percent)ë¥¼ ë°”ê¿”ì„œ ê·¸ë˜í”„ê°€ ì±„ì›Œì§€ê²Œ í•©ë‹ˆë‹¤.

  [ì–´ë””ë¥¼ ìˆ˜ì •í•´ìš”?]
  - ì•„ë˜ API_BASEì™€ periodYmë§Œ ì—¬ëŸ¬ë¶„ ì„œë²„ ìƒí™©ì— ë§ê²Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.
  - ë‚˜ë¨¸ì§€ëŠ” ê±´ë“¤ í•„ìš” ì—†ì–´ìš”.
*/
(async function () {
  // 1) ì—¬ëŸ¬ë¶„ ë°±ì—”ë“œ ì£¼ì†Œ (ì˜ˆ: /api/donut)
  const API_BASE = "/api/donut";

  // 2) ì¡°íšŒí•  ê¸°ê°„(YYYY-MM). í˜„ì¬ ë‹¬ë¡œ ìë™ ì„¤ì •í•´ ë‘ .
  //    í•„ìš”í•˜ë©´ "2025-08" ì²˜ëŸ¼ ì§ì ‘ ë¬¸ìì—´ë¡œ ë„£ì–´ë„ ë©ë‹ˆë‹¤.
  const now = new Date();
  const periodYm =
    now.getFullYear() + "-" + String(now.getMonth() + 1).padStart(2, "0");

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì•„ë˜ë¶€í„°ëŠ” ì½”ë“œê°€ ìë™ìœ¼ë¡œ í•´ì¤˜ìš”. ìˆ˜ì • ë¶ˆí•„ìš”!
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  // (ì¤‘ìš”) ìš°ë¦¬ HTMLì˜ ìš”ì†Œë“¤ ì¡ê¸°
  //  - ì „ê¸° ê¸ˆì•¡:  #elecPrice
  //  - ê°€ìŠ¤ ê¸ˆì•¡:  #waterPrice  â†(ì£¼ì˜) HTMLì—ì„œ ê°€ìŠ¤ ì¹´ë“œì— ì´ idê°€ ì“°ì´ê³  ìˆìŒ
  //  - ì´í•© ê¸ˆì•¡:  #totalPrice  (ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸)
  //  - ì „ê¸° ë„ë„›:  #donutElec
  //  - ê°€ìŠ¤ ë„ë„›:  #donutWater  â†(ì£¼ì˜) ì´ë¦„ì€ waterì§€ë§Œ ê°€ìŠ¤ ë„ë„›ì„
  const $elecPrice = document.getElementById("elecPrice");
  const $gasPrice  = document.getElementById("waterPrice"); // HTML êµ¬ì¡°ì— ë§ì¶¤
  const $total     = document.getElementById("totalPrice");
  const $donutElec = document.getElementById("donutElec");
  const $donutGas  = document.getElementById("donutWater");

  // ìˆ«ìë¥¼ 12,345 ì²˜ëŸ¼ ì˜ˆì˜ê²Œ í¬ë§·
  const fmt = new Intl.NumberFormat("ko-KR");

  // (ì„ ë°©) YYYY-MM í˜•ì‹ í™•ì¸ â†’ í‹€ë¦¬ë©´ ì•„ì˜ˆ ìš”ì²­í•˜ì§€ ì•ŠìŒ (ë°±ì—”ë“œ 400 ì˜ˆë°©)
  const isYm = /^\d{4}-(0[1-9]|1[0-2])$/.test(periodYm);
  if (!isYm) {
    console.warn("periodYm í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”. ì˜ˆ: 2025-08");
    return; // ìš”ì²­ ì¤‘ë‹¨, í™”ë©´ ê°’ì€ ê¸°ì¡´ ê·¸ëŒ€ë¡œ ë‘ 
  }

  try {
    // ì„œë²„ë¡œ ìš”ì²­ ë³´ë‚´ê¸°
    const res = await fetch(`${API_BASE}?periodYm=${encodeURIComponent(periodYm)}`);

    // 400: period í˜•ì‹ì´ YYYY-MM ì´ ì•„ë‹Œ ê²½ìš° (ë°±ì—”ë“œ ëª…ì„¸)
    if (res.status === 400) {
      console.error("ì„œë²„ê°€ 400ì„ ëŒë ¤ì¤¬ì–´ìš”. periodYm í˜•ì‹ì„ í™•ì¸í•´ ì£¼ì„¸ìš” (YYYY-MM).");
      return; // í™”ë©´ì€ ê¸°ì¡´ ê°’ ìœ ì§€
    }

    // ê·¸ ì™¸ ì‹¤íŒ¨
    if (!res.ok) {
      console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. (ìƒíƒœ:", res.status, ")");
      return;
    }

    // 200 OK â†’ JSON êº¼ë‚´ê¸°
    /** ê¸°ëŒ€í•˜ëŠ” ì‘ë‹µ í˜•íƒœ (DonutResponse)
     * {
     *   "periodYm": "2025-08",
     *   "elec": 13830,        // ì „ê¸°ìš”ê¸ˆ(ì›)
     *   "gas":  7820,         // ê°€ìŠ¤ìš”ê¸ˆ(ì›)
     *   "total": 21650,       // í•©ê³„
     *   "elecRatio": 0.64,    // 0~1 (í•©ê³„ê°€ 0ì´ë©´ 0)
     *   "gasRatio":  0.36
     * }
     */
    const data = await res.json();

    // ê¸ˆì•¡ í…ìŠ¤íŠ¸ ë°”ê¾¸ê¸° (ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¡°ìš©íˆ íŒ¨ìŠ¤)
    if ($elecPrice && typeof data.elec === "number") {
      $elecPrice.textContent = `${fmt.format(data.elec)} ì›`;
    }
    if ($gasPrice && typeof data.gas === "number") {
      $gasPrice.textContent = `${fmt.format(data.gas)} ì›`;
    }
    if ($total && typeof data.total === "number") {
      $total.textContent = `${fmt.format(data.total)} ì›`;
    }

    // ë„ë„› ì±„ìš°ê¸° í¼ì„¼íŠ¸ ê³„ì‚°(0~100)
    // ì„œë²„ëŠ” 0~1 ì‚¬ì´ ë¹„ìœ¨ì„ ì£¼ë¯€ë¡œ 100ì„ ê³±í•´ìš”.
    const elecPct = Math.max(0, Math.min(100, Math.round((data.elecRatio || 0) * 100)));
    const gasPct  = Math.max(0, Math.min(100, Math.round((data.gasRatio  || 0) * 100)));

    // CSS ë³€ìˆ˜ --percentì— ìˆ«ì ë„£ê¸° â†’ conic-gradientë¡œ ë„ë„›ì´ ì±„ì›Œì§
    if ($donutElec) $donutElec.style.setProperty("--percent", elecPct);
    if ($donutGas)  $donutGas.style.setProperty("--percent",  gasPct);

  } catch (err) {
    // ì¸í„°ë„·ì´ ëŠê²¼ê±°ë‚˜, CORS ë“±ìœ¼ë¡œ ì‹¤íŒ¨í•œ ê²½ìš°
    console.error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”.", err);
    // í™”ë©´ì€ ê¸°ì¡´ ê°’ ìœ ì§€ (ì‚¬ìš©ìì—ê²Œ ê¹¨ì§„ í™”ë©´ì„ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ)
  }
})();
</script>
<script>
/*
  [ë¬´ì—‡ì„ í•˜ë‚˜ìš”?]
  - ë°±ì—”ë“œì—ì„œ ì›”ë³„ ì¼ì ëˆ„ì  ê°’(ì „ê¸°/ê°€ìŠ¤/í•©ê³„)ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  - ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ "ëˆ„ì  ë§‰ëŒ€ì°¨íŠ¸"ë¥¼ SVGë¡œ ê·¸ë¦½ë‹ˆë‹¤(í•´ë‹¹ ë°•ìŠ¤ ì•ˆì—ì„œë§Œ).
  - í™”ë©´ ë ˆì´ì•„ì›ƒ/í¬ê¸°ëŠ” ë°”ê¾¸ì§€ ì•ŠìŠµë‹ˆë‹¤.

  [ì–´ë””ì— ë¶™ì´ë‚˜ìš”?]
  - ì´ <script>ë¥¼ í˜ì´ì§€ ë§¨ ì•„ë˜, </body> ë°”ë¡œ ìœ„ì— ë¶™ì´ë©´ ë©ë‹ˆë‹¤.

  [ì–´ë–¤ ìš”ì†Œì— ê·¸ë¦¬ë‚˜ìš”?]
  - ìš°ì„  id="chartBars" ìš”ì†Œë¥¼ ì°¾ìŠµë‹ˆë‹¤.
  - ì—†ìœ¼ë©´ .chart-line ìš”ì†Œë¥¼ ì°¾ì•„ ê·¸ ì•ˆì— ê·¸ë¦½ë‹ˆë‹¤.
*/

(async function () {
  // 1) ì—¬ëŸ¬ë¶„ ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸ (ì˜ˆ: /api/monthly-bars)
  const API_BASE = "/api/monthly-bars";

  // 2) ì¡°íšŒ ê¸°ê°„(YYYY-MM). ê¸°ë³¸ì€ í˜„ì¬ ë‹¬ë¡œ ìë™ ì„¤ì •.
  //    í•„ìš”í•˜ë©´ "2025-08" ì²˜ëŸ¼ ì§ì ‘ ë¬¸ìì—´ë¡œ ê³ ì •í•´ë„ ë©ë‹ˆë‹¤.
  const now = new Date();
  const periodYm =
    now.getFullYear() + "-" + String(now.getMonth() + 1).padStart(2, "0");

  // 3) ì°¨íŠ¸ë¥¼ ê·¸ë¦´ ì»¨í…Œì´ë„ˆ ì°¾ê¸°(ìš°ì„ ìˆœìœ„: #chartBars â†’ .chart-line)
  const container =
    document.getElementById("chartBars") ||
    document.querySelector(".chart-line");

  if (!container) {
    console.warn("ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ(#chartBars ë˜ëŠ” .chart-line)ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
    return;
  }

  // ë³´ê¸° ì¢‹ì€ ìˆ«ì í¬ë§·(12,345)
  const fmt = new Intl.NumberFormat("ko-KR");

  // YYYY-MM í˜•ì‹ ì²´í¬(ë°±ì—”ë“œ 400 ì˜ˆë°©)
  const isYm = /^\d{4}-(0[1-9]|1[0-2])$/.test(periodYm);
  if (!isYm) {
    console.warn("periodYm í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”. ì˜ˆ: 2025-08");
    return;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // API í˜¸ì¶œ
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let chartData = null;
  try {
    const res = await fetch(`${API_BASE}?periodYm=${encodeURIComponent(periodYm)}`);

    if (res.status === 400) {
      console.error("ì„œë²„ 400: periodYm í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”(YYYY-MM).");
      return;
    }
    if (!res.ok) {
      console.error("ë°ì´í„° ìš”ì²­ ì‹¤íŒ¨. ìƒíƒœ:", res.status);
      return;
    }

    /** ê¸°ëŒ€ ì‘ë‹µ(200 OK)
     * {
     *   "periodYm": "2025-08",
     *   "bars": [
     *     { "day": 1, "elecCum": 4800,  "gasCum": 3100, "totalCum": 7900  },
     *     { "day": 2, "elecCum": 9600,  "gasCum": 6400, "totalCum": 16000 },
     *     ...
     *   ]
     * }
     */
    chartData = await res.json();
  } catch (err) {
    console.error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.", err);
    return;
  }

  // bars ë°°ì—´ì´ ì—†ê±°ë‚˜ ë¹„ë©´ ì¢…ë£Œ
  if (!chartData || !Array.isArray(chartData.bars) || !chartData.bars.length) {
    container.textContent = "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ì°¨íŠ¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜ (ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶° SVG ìƒì„±)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function drawBars() {
    // ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¥¼ ê¹¨ë—ì´ ë¹„ì›€(ë ˆì´ì•„ì›ƒ ìì²´ëŠ” ì•ˆ ê±´ë“œë¦½ë‹ˆë‹¤)
    container.innerHTML = "";

    // ì»¨í…Œì´ë„ˆì˜ í˜„ì¬ í”½ì…€ í¬ê¸°ë¥¼ ê°€ì ¸ì™€ ê·¸ ì•ˆì— SVGë¥¼ ë§Œë“­ë‹ˆë‹¤.
    const width  = Math.max(200, Math.floor(container.clientWidth));
    const height = Math.max(160, 180); // ë„ˆë¬´ ë‚®ì§€ ì•Šê²Œ ê¸°ë³¸ 180px

    const margin = { top: 8, right: 8, bottom: 22, left: 28 };
    const iw = width  - margin.left - margin.right; // inner width
    const ih = height - margin.top  - margin.bottom; // inner height

    // y ìŠ¤ì¼€ì¼: ìµœëŒ€ totalCum ê¸°ì¤€ìœ¼ë¡œ ë†’ì´ë¥¼ ì •í•¨
    const maxY = chartData.bars.reduce((m, b) => Math.max(m, b.totalCum || 0), 0) || 1;

    // x ê°„ê²©(ë§‰ëŒ€ ê°œìˆ˜ì— ë”°ë¼ ìë™ ê³„ì‚°)
    const n = chartData.bars.length;
    const slot = iw / n;                    // ê° ì¼(day)ë§ˆë‹¤ ì“¸ ìˆ˜ ìˆëŠ” ê°€ë¡œì¹¸
    const barW = Math.max(3, Math.min(20, slot * 0.6)); // ë§‰ëŒ€ ì‹¤ì œ ë„ˆë¹„(ë„ˆë¬´ ë‘ê»/ì–‡ì§€ ì•Šê²Œ)

    // SVG ìƒì„±
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("width", width);
    svg.setAttribute("height", height);
    svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
    svg.style.display = "block"; // ë¶€ëª¨ ë ˆì´ì•„ì›ƒ ì˜í–¥ ì—†ìŒ

    // ë°°ê²½ ê·¸ë¦¬ë“œ 3ì¤„ ì •ë„(ì½ê¸° ë„ì›€ìš©, ìŠ¤íƒ€ì¼ì€ ì€ì€í•˜ê²Œ)
    const gridG = document.createElementNS(svg.namespaceURI, "g");
    const gridCount = 3;
    for (let i = 1; i <= gridCount; i++) {
      const y = margin.top + (ih * i) / (gridCount + 1);
      const line = document.createElementNS(svg.namespaceURI, "line");
      line.setAttribute("x1", margin.left);
      line.setAttribute("y1", y);
      line.setAttribute("x2", width - margin.right);
      line.setAttribute("y2", y);
      line.setAttribute("stroke", "rgba(0,0,0,0.06)");
      line.setAttribute("stroke-width", "1");
      gridG.appendChild(line);
    }
    svg.appendChild(gridG);

    // ë§‰ëŒ€ ê·¸ë£¹
    const barsG = document.createElementNS(svg.namespaceURI, "g");

    chartData.bars.forEach((b, i) => {
      const xCenter = margin.left + i * slot + slot / 2;
      const x = xCenter - barW / 2;

      const total = Math.max(0, b.totalCum || 0);
      const elec  = Math.max(0, b.elecCum  || 0);
      const gas   = Math.max(0, b.gasCum   || 0);

      // ë†’ì´(í”½ì…€)ë¡œ ë³€í™˜
      const totalH = (total / maxY) * ih;
      const elecH  = (elec  / maxY) * ih;
      let gasH     = totalH - elecH;            // ëˆ„ì : total = elec + gas
      gasH = Math.max(0, gasH);                 // í˜¹ì‹œ ë°˜ì˜¬ë¦¼ìœ¼ë¡œ ìŒìˆ˜ ë°©ì§€

      const baseY  = height - margin.bottom;

      // ê°€ìŠ¤(ì•„ë˜ìª½) â€“ ì£¼í™©
      const gasRect = document.createElementNS(svg.namespaceURI, "rect");
      gasRect.setAttribute("x", x);
      gasRect.setAttribute("y", baseY - gasH);
      gasRect.setAttribute("width", barW);
      gasRect.setAttribute("height", gasH);
      gasRect.setAttribute("rx", "2");
      gasRect.setAttribute("fill", "#f97316"); // ê°€ìŠ¤(ì£¼í™©)
      barsG.appendChild(gasRect);

      // ì „ê¸°(ìœ„ìª½) â€“ ë…¸ë‘
      const elecRect = document.createElementNS(svg.namespaceURI, "rect");
      elecRect.setAttribute("x", x);
      elecRect.setAttribute("y", baseY - totalH);
      elecRect.setAttribute("width", barW);
      elecRect.setAttribute("height", elecH);
      elecRect.setAttribute("rx", "2");
      elecRect.setAttribute("fill", "#facc15"); // ì „ê¸°(ë…¸ë‘)
      barsG.appendChild(elecRect);

      // xì¶• ë¼ë²¨(5ì¼ì— í•œ ë²ˆë§Œ í‘œì‹œí•´ ë³µì¡ë„ ì¤„ì„)
      if (b.day % 5 === 0 || i === 0 || i === n - 1) {
        const label = document.createElementNS(svg.namespaceURI, "text");
        label.setAttribute("x", xCenter);
        label.setAttribute("y", baseY + 14);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("fill", "rgba(0,0,0,0.55)");
        label.textContent = b.day; // ì¼(day)
        barsG.appendChild(label);
      }
    });

    svg.appendChild(barsG);

    // ê°„ë‹¨í•œ ë²”ë¡€(ì „ê¸°/ê°€ìŠ¤)
    const legendG = document.createElementNS(svg.namespaceURI, "g");
    const items = [
      { color: "#facc15", label: "ì „ê¸° ëˆ„ì " },
      { color: "#f97316", label: "ê°€ìŠ¤ ëˆ„ì " },
    ];
    let lx = width - margin.right - 100; // ì˜¤ë¥¸ìª½ ìœ„ì— ë°°ì¹˜
    const ly = margin.top + 6;
    items.forEach((it, idx) => {
      const box = document.createElementNS(svg.namespaceURI, "rect");
      box.setAttribute("x", lx + idx * 60);
      box.setAttribute("y", ly - 8);
      box.setAttribute("width", 10);
      box.setAttribute("height", 10);
      box.setAttribute("rx", 2);
      box.setAttribute("fill", it.color);
      legendG.appendChild(box);

      const txt = document.createElementNS(svg.namespaceURI, "text");
      txt.setAttribute("x", lx + 14 + idx * 60);
      txt.setAttribute("y", ly);
      txt.setAttribute("font-size", "10");
      txt.setAttribute("fill", "rgba(0,0,0,0.6)");
      txt.textContent = it.label;
      legendG.appendChild(txt);
    });
    svg.appendChild(legendG);

    container.appendChild(svg);
  }

  // ì²« ê·¸ë¦¬ê¸°
  drawBars();

  // ì»¨í…Œì´ë„ˆê°€ ë¦¬ì‚¬ì´ì¦ˆë˜ë©´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°(ë””ë°”ìš´ìŠ¤)
  let t;
  window.addEventListener("resize", () => {
    clearTimeout(t);
    t = setTimeout(drawBars, 150);
  });
})();
</script>
<script>
/*
  âœ” ë¬´ì—‡ì„ í•˜ë‚˜ìš”?
  - ì ˆì•½ ëª©í‘œ ì…ë ¥ í¼(#goalForm)ì„ ê°€ë¡œì±„ì„œ ì„œë²„ì— ì €ì¥(POST)í•©ë‹ˆë‹¤.
  - ì‘ë‹µ(GoalResponse)ìœ¼ë¡œ ë°›ì€ í¼ì„¼íŠ¸ë¥¼ í™”ë©´ì— ë°˜ì˜í•©ë‹ˆë‹¤.
  - 400 ì˜¤ë¥˜(period í˜•ì‹, ìŒìˆ˜ ê¸ˆì•¡)ë„ ë©”ì‹œì§€ë¡œ ì•Œë ¤ì¤ë‹ˆë‹¤.

  âœ” ì–´ë””ì— ë¶™ì´ë‚˜ìš”?
  - ì´ <script>ë¥¼ í˜ì´ì§€ ë§¨ ì•„ë˜, </body> ë°”ë¡œ ìœ„ì— ë¶™ì´ë©´ ë©ë‹ˆë‹¤.

  âœ” í™”ë©´ì—ì„œ ì–´ë–¤ ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?
  - #goalForm  : í¼
  - #goalInput : ëª©í‘œ ê¸ˆì•¡ ì…ë ¥ <input>
  - #goalHint  : ì•ˆë‚´ ë¬¸êµ¬ ì˜ì—­(ì—¬ê¸°ì— ì„±ê³µ/ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥)
  - #goalPct   : "xx%" í…ìŠ¤íŠ¸
  - #goalFill  : ì§„í–‰ ë°”(.style.width ë¡œ ì±„ì›€)
  - #savedNow  : "ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: xì›" í…ìŠ¤íŠ¸
  (ìœ„ ì•„ì´ë””ê°€ ì—†ëŠ” ê²½ìš°ì—” í•´ë‹¹ í•­ëª©ì€ ë¬´ì‹œí•˜ê³  ë„˜ì–´ê°‘ë‹ˆë‹¤)
*/
(function () {
  // === 0) ì—¬ëŸ¬ë¶„ í™˜ê²½ì— ë§ê²Œ 'ë”± 2ê³³'ë§Œ ìˆ˜ì •í•˜ë©´ ë! =====================
  const API_URL = "/api/saving-goal"; // â† ë°±ì—”ë“œ 'ì ˆì•½ ëª©í‘œ ì €ì¥' ì—”ë“œí¬ì¸íŠ¸
  const USER_ID = 1;                  // â† ë¡œê·¸ì¸ëœ ì‚¬ìš©ì IDë¡œ êµì²´í•˜ì„¸ìš”
  // ======================================================================

  // DOM ì°¸ì¡°
  const d       = document;
  const form    = d.getElementById("goalForm");
  const input   = d.getElementById("goalInput");
  const hintEl  = d.getElementById("goalHint");
  const pctEl   = d.getElementById("goalPct");
  const fillEl  = d.getElementById("goalFill");
  const savedEl = d.getElementById("savedNow");

  if (!form || !input) return; // í¼ì´ ì—†ìœ¼ë©´ ì•„ë¬´ ê²ƒë„ í•˜ì§€ ì•ŠìŒ

  // ë³´ê¸° ì¢‹ì€ ìˆ«ì í¬ë§·(12,345)
  const fmt = new Intl.NumberFormat("ko-KR");

  // YYYY-MM(ì˜ˆ: 2025-08) ë§Œë“¤ê¸°
  function getPeriodYm() {
    const now = new Date();
    return now.getFullYear() + "-" + String(now.getMonth() + 1).padStart(2, "0");
  }

  // ë²”ìœ„ ì œí•œ ìœ í‹¸
  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

  // hint ë¬¸êµ¬ ì¶œë ¥(ì˜¤ë¥˜ëŠ” ë¶‰ê²Œ)
  function msg(text, isError) {
    if (!hintEl) return;
    hintEl.textContent = text;
    hintEl.style.color = isError ? "#e11d48" : ""; // ê¸°ë³¸ìƒ‰ìœ¼ë¡œ ë³µê·€
  }

  // í¼ ì œì¶œ â†’ ì„œë²„ë¡œ ì €ì¥
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const raw = Number(input.value);
    if (!Number.isFinite(raw) || raw < 0) {
      msg("ëª©í‘œ ê¸ˆì•¡ì„ 0 ì´ìƒ ìˆ«ìë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.", true);
      return;
    }

    // ë°±ì—”ë“œê°€ ìš”êµ¬í•˜ëŠ” RequestBody(GoalRequest)
    const body = {
      userId: USER_ID,              // ë¡œê·¸ì¸ ìœ ì € ID
      periodYm: getPeriodYm(),      // "YYYY-MM"
      savingGoalWon: Math.round(raw) // ëª©í‘œ ê¸ˆì•¡(ì›) - ì •ìˆ˜ë¡œ ë³´ëƒ„
    };

    // periodYm í˜•ì‹ ì‚¬ì „ ì ê²€(400 ì˜ˆë°©)
    const isYm = /^\d{4}-(0[1-9]|1[0-2])$/.test(body.periodYm);
    if (!isYm) {
      msg("ê¸°ê°„ í˜•ì‹(YYYY-MM)ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
      return;
    }

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      // ë°±ì—”ë“œ ëª…ì„¸: 400 â†’ period í˜•ì‹ ì˜¤ë¥˜ ë˜ëŠ” savingGoalWon < 0
      if (res.status === 400) {
        msg("ìš”ì²­ í˜•ì‹ ì˜¤ë¥˜: ê¸°ê°„(YYYY-MM) ë˜ëŠ” ëª©í‘œ ê¸ˆì•¡(0 ì´ìƒ)ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.", true);
        return;
      }
      if (!res.ok) {
        msg("ì„œë²„ ì˜¤ë¥˜ë¡œ ì €ì¥í•˜ì§€ ëª»í–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.", true);
        return;
      }

      /* ê¸°ëŒ€ ì‘ë‹µ(GoalResponse)
        {
          "periodYm": "2025-08",
          "savingGoalWon": 5000,     // ë°©ê¸ˆ ì €ì¥í•œ ëª©í‘œ
          "baselineTotalWon": 24800, // ì „ì›” ì´ì•¡(ì—†ìœ¼ë©´ ì¶”ì •ì¹˜)
          "currentTotalWon": 21650,  // í˜„ì›” ì´ì•¡(ë„ë„› total)
          "savingPercent": 12.7      // (baseline-current)/baseline*100
        }
      */
      const data = await res.json();

      // ì•ˆì „í•˜ê²Œ ê°’ êº¼ë‚´ê¸°
      const baseline = Number(data.baselineTotalWon || 0);
      const current  = Number(data.currentTotalWon  || 0);
      const saved    = Math.max(0, baseline - current);
      const percent  = clamp(Number(data.savingPercent || 0), 0, 100);

      // UI ë°˜ì˜(í…ìŠ¤íŠ¸ì™€ ë„ˆë¹„ë§Œ ë³€ê²½ â†’ ë ˆì´ì•„ì›ƒ ì˜í–¥ ì—†ìŒ)
      if (savedEl) savedEl.textContent = `ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: ${fmt.format(saved)} ì›`;
      if (pctEl)   pctEl.textContent   = `${percent.toFixed(1)}%`;
      if (fillEl)  fillEl.style.width  = `${percent}%`;

      msg(`ëª©í‘œ ${fmt.format(data.savingGoalWon)} ì› ì €ì¥ ì™„ë£Œ!`, false);

      // 100% ë‹¬ì„± ë±ƒì§€ ì˜ì—­ì´ ìˆë‹¤ë©´ í‘œì‹œ(ì„ íƒ)
      const badge = d.getElementById("goalSuccess");
      if (badge) badge.style.display = percent >= 100 ? "block" : "none";
    } catch (err) {
      console.error(err);
      msg("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì €ì¥í•˜ì§€ ëª»í–ˆì–´ìš”. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.", true);
    }
  });

  // ì´ˆê¸°í™” ë²„íŠ¼(#goalClear)ì´ ìˆìœ¼ë©´ í™”ë©´ ê°’ë§Œ ë¦¬ì…‹(ì„œë²„ í˜¸ì¶œ ì—†ìŒ)
  d.getElementById("goalClear")?.addEventListener("click", () => {
    input.value = "";
    if (pctEl)   pctEl.textContent = "0%";
    if (fillEl)  fillEl.style.width = "0%";
    if (savedEl) savedEl.textContent = "ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: 0 ì›";
    msg("ëª©í‘œë¥¼ ì„¤ì •í•´ ì§„í–‰ë¥ ì„ í™•ì¸í•´ ë³´ì„¸ìš”", false);
  });
})();
</script>
<script>
/*
  âœ” ë¬´ì—‡ì„ í•˜ë‚˜ìš”?
  - í˜ì´ì§€ê°€ ì—´ë¦´ ë•Œ GET API(GoalResponse)ë¥¼ í˜¸ì¶œí•´
    ì €ì¥ëœ ëª©í‘œ/ì „ì›”/í˜„ì›”/ì ˆê°ë¥ ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
  - ê°€ì ¸ì˜¨ ê°’ìœ¼ë¡œ ì§„í–‰ë°”(#goalFill), í¼ì„¼íŠ¸(#goalPct),
    ì ˆê°ì•¡(#savedNow), ì•ˆë‚´ë¬¸(#goalHint), ì…ë ¥ê°’(#goalInput)ì„ ì±„ì›ë‹ˆë‹¤.

  âœ” ì–´ë””ì— ë¶™ì´ë‚˜ìš”?
  - ì´ <script>ë¥¼ í˜ì´ì§€ ë§¨ ì•„ë˜, </body> ë°”ë¡œ ìœ„ì— ë¶™ì…ë‹ˆë‹¤.

  âœ” í™”ë©´ì—ì„œ ì–´ë–¤ ìš”ì†Œë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”? (ì—†ìœ¼ë©´ ê±´ë„ˆëœ€)
  - #goalInput  : ëª©í‘œ ê¸ˆì•¡ ì…ë ¥ì°½
  - #goalHint   : "ëª©í‘œë¥¼ ì„¤ì •â€¦" ì•ˆë‚´ ë¬¸êµ¬ (ì—¬ê¸°ì— "ëª©í‘œÂ·ë‚¨ì€ ê¸ˆì•¡"ì„ ë³´ì—¬ì¤Œ)
  - #goalPct    : "xx%" í…ìŠ¤íŠ¸
  - #goalFill   : ì§„í–‰ ë°”(í­ì„ %ë¡œ ì±„ì›€)
  - #savedNow   : "ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: x ì›"
  - #goalSuccess: 100% ë‹¬ì„± ë±ƒì§€ ì˜ì—­(ìˆìœ¼ë©´ í‘œì‹œ)
*/
(function () {
  // === 0) ì—¬ëŸ¬ë¶„ í™˜ê²½ì— ë§ê²Œ 'ë”± 2ê³³'ë§Œ ìˆ˜ì •í•˜ë©´ ë! =====================
  const API_GET_URL = "/api/saving-goal"; // â† ì ˆì•½ ëª©í‘œ ì¡°íšŒ ì—”ë“œí¬ì¸íŠ¸ (GET)
  const USER_ID     = 1;                  // â† ë¡œê·¸ì¸ëœ ì‚¬ìš©ì IDë¡œ êµì²´
  // ======================================================================

  // DOM ìš”ì†Œ ì°¸ì¡°(ì—†ìœ¼ë©´ null â†’ ì´í›„ ì•ˆì „í•˜ê²Œ ì²´í¬)
  const d       = document;
  const input   = d.getElementById("goalInput");
  const hintEl  = d.getElementById("goalHint");
  const pctEl   = d.getElementById("goalPct");
  const fillEl  = d.getElementById("goalFill");
  const savedEl = d.getElementById("savedNow");
  const badge   = d.getElementById("goalSuccess");

  // ë³´ê¸° ì¢‹ì€ ìˆ«ì í¬ë§·(12,345)
  const fmt = new Intl.NumberFormat("ko-KR");

  // í˜„ì¬ ë‹¬ì„ "YYYY-MM" í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ê¸° (ì˜ˆ: 2025-08)
  function getPeriodYm() {
    const now = new Date();
    return now.getFullYear() + "-" + String(now.getMonth() + 1).padStart(2, "0");
  }

  // 0~100 ì‚¬ì´ë¡œ ì œí•œ
  const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

  // ì•ˆë‚´ë¬¸ í‘œì‹œ(ì˜¤ë¥˜ë©´ ë¶‰ì€ìƒ‰)
  function msg(text, isError=false) {
    if (!hintEl) return;
    hintEl.textContent = text;
    hintEl.style.color = isError ? "#e11d48" : ""; // ì˜¤ë¥˜: ë¶‰ì€ìƒ‰, ì•„ë‹ˆë©´ ê¸°ë³¸ìƒ‰
  }

  // 1) ì„œë²„ì—ì„œ ëª©í‘œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (GET /api/saving-goal?userId=1&periodYm=YYYY-MM)
  async function fetchGoal() {
    const periodYm = getPeriodYm();

    // 400 ë°©ì§€: YYYY-MM í˜•ì‹ ì‚¬ì „ ì ê²€
    const isYm = /^\d{4}-(0[1-9]|1[0-2])$/.test(periodYm);
    if (!isYm) {
      msg("ê¸°ê°„ í˜•ì‹(YYYY-MM)ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
      return;
    }

    // ì‹¤ì œ í˜¸ì¶œ URL ë§Œë“¤ê¸°
    const url = `${API_GET_URL}?userId=${encodeURIComponent(USER_ID)}&periodYm=${encodeURIComponent(periodYm)}`;

    try {
      const res = await fetch(url, { method: "GET" });

      // ë°±ì—”ë“œ ëª…ì„¸: 400 â†’ period í˜•ì‹ ì˜¤ë¥˜ ë“±
      if (res.status === 400) {
        msg("ìš”ì²­ í˜•ì‹ ì˜¤ë¥˜: ê¸°ê°„(YYYY-MM)ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.", true);
        return;
      }

      if (res.status === 204) {
        // ë°ì´í„° ì—†ìŒ(ì•„ì§ ëª©í‘œë¥¼ ì €ì¥í•˜ì§€ ì•Šì€ ê²½ìš° ë“±)
        msg("ëª©í‘œë¥¼ ì„¤ì •í•´ ì§„í–‰ë¥ ì„ í™•ì¸í•´ ë³´ì„¸ìš”");
        return;
      }

      if (!res.ok) {
        msg("ì„œë²„ ì˜¤ë¥˜ë¡œ ëª©í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.", true);
        return;
      }

      /* ê¸°ëŒ€ ì‘ë‹µ(GoalResponse) ì˜ˆì‹œ:
        {
          "periodYm": "2025-08",
          "savingGoalWon": 5000,
          "baselineTotalWon": 24800,
          "currentTotalWon": 21650,
          "savingPercent": 12.7
        }
      */
      const data = await res.json();
      renderGoal(data);
    } catch (err) {
      console.error(err);
      msg("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ëª©í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.", true);
    }
  }

  // 2) í™”ë©´ì— ê°’ ë°˜ì˜í•˜ê¸°
  function renderGoal(data) {
    // ì‘ë‹µ ê°’ ì•ˆì „í•˜ê²Œ ìˆ«ìë¡œ ë³€í™˜
    const target   = Number(data.savingGoalWon || 0);       // ëª©í‘œ ê¸ˆì•¡
    const baseline = Number(data.baselineTotalWon || 0);    // ì „ì›” ì´ì•¡(ì—†ìœ¼ë©´ 0)
    const current  = Number(data.currentTotalWon  || 0);    // í˜„ì›” ì´ì•¡
    const saved    = Math.max(0, baseline - current);       // ì ˆê°ì•¡(ìŒìˆ˜ ë°©ì§€)
    // í¼ì„¼íŠ¸: ì„œë²„ê°€ ì¤€ ê°’ ìš°ì„ , ì—†ìœ¼ë©´ (baseline-current)/baseline*100
    const percentCalc = baseline > 0 ? ((baseline - current) / baseline) * 100 : 0;
    const percent = clamp(
      Number.isFinite(Number(data.savingPercent)) ? Number(data.savingPercent) : percentCalc,
      0, 100
    );

    // 2-1) ì…ë ¥ì°½ì— ëª©í‘œ ê¸ˆì•¡ ì±„ìš°ê¸°
    if (input) input.value = target ? String(target) : "";

    // 2-2) "ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: x ì›"
    if (savedEl) savedEl.textContent = `ì´ë²ˆ ë‹¬ ì ˆê°ì•¡: ${fmt.format(saved)} ì›`;

    // 2-3) ì§„í–‰ í¼ì„¼íŠ¸/ê²Œì´ì§€ ì±„ìš°ê¸°
    if (pctEl)  pctEl.textContent  = `${percent.toFixed(1)}%`;
    if (fillEl) fillEl.style.width = `${percent}%`;

    // 2-4) ì•ˆë‚´ ë¬¸êµ¬ì— "ëª©í‘œÂ·ë‚¨ì€ ê¸ˆì•¡" ë³´ì—¬ì£¼ê¸°
    if (hintEl) {
      const remain = Math.max(0, target - saved); // ëª©í‘œ - ì ˆê°ì•¡
      hintEl.textContent = `ëª©í‘œ: ${fmt.format(target)} ì› Â· ë‚¨ì€ ê¸ˆì•¡ ${fmt.format(remain)} ì›`;
      hintEl.style.color = ""; // ê¸°ë³¸ìƒ‰ìœ¼ë¡œ
    }

    // 2-5) 100% ë‹¬ì„± ë±ƒì§€(ìˆì„ ë•Œë§Œ)
    if (badge) badge.style.display = percent >= 100 ? "block" : "none";
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì¡°íšŒ
  document.addEventListener("DOMContentLoaded", fetchGoal);
})();
</script>
</body>
</html>
